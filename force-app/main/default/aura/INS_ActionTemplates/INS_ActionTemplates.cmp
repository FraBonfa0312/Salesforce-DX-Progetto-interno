<aura:component controller="INS_ActionTemplateList" implements="force:hasRecordId,flexipage:availableForRecordHome,flexipage:availableForAllPageTypes,forceCommunity:availableForAllPageTypes,force:lightningQuickAction">
    <aura:attribute name="templates" access="global" type="ActionPlanTemplate[]" />
    <aura:attribute name="selectedTemplateId" type="String" />
    <aura:attribute name="actionPlanName" type="String" />
    <aura:attribute name="startDate" type="String" />
    <aura:attribute name="actionPlanType" type="String" />

    <aura:attribute name="record" type="Object"/>
    <aura:attribute name="recordLoadError" type="String"/>
    
    <force:recordData aura:id="recordLoader"
        recordId="{!v.recordId}"
        fields="Name,OwnerId"
        targetFields="{!v.record}"
        targetError="{!v.recordLoadError}"
    />
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    
    <div class="slds-theme_default slds-p-around_small">
        
    <ui:scrollerWrapper class="scrollerSize"> 
        
        <aura:if isTrue="{!v.templates.length == 0}">
            <div class="message">
                <lightning:icon iconName="utility:warning" size="small" alternativeText="Warning!" variant="warning"/>
                No action templates found
            </div>
        </aura:if>  
        
        <aura:if isTrue="{!v.templates.length != 0}">
            <lightning:card title="Recommended Action Plans" iconName="custom:custom18" variant="base">

                <fieldset class="slds-form-element">
                    <div class="slds-form-element__control">
                        	<lightning:layout horizontalAlign="start" multipleRows="true">
   
                                <lightning:layoutItem flexibility="no-grow" padding="around-small">   
                                    <aura:iteration items="{!v.templates}" var="template">  
                                        <div class="slds-visual-picker slds-visual-picker_vertical" >  
                                            <input type="radio" id="{!template.Id}" data-template="{!template.Name}" name="options" value="on" onclick="{!c.handleActionPlanSelection}"/>
                                            <label for="{!template.Id}">
                                                <span class="slds-visual-picker__figure  slds-visual-picker__text">
                                                    <div class="slds-text-heading_small">{!template.Name}
                                                    <div class="slds-card__body">
                                                        <div class="slds-text-body_regular">
                                                            {!template.ActionPlanTemplate.Description}
                                                        </div>
                                                    </div>
                                                    </div>
                                                </span>
                                            </label>
                                            <span
                                                class="slds-icon_container slds-visual-picker__text-check">
                                                <lightning:icon iconName="utility:check" size="x-small" variant="inverse"></lightning:icon>
                                            </span>
                                        </div>
                                    </aura:iteration>
                            </lightning:layoutItem>

                            <lightning:layoutItem flexibility="grow"  padding="around-small">   
                                <div class="slds-m-bottom_medium">
                                    <lightning:input label="Plan Name" value="{!v.actionPlanName}"/>  
                                    <lightning:input type="date" label="Plan Start Date" aura:id="date" value="{!v.startDate}"/>
                                </div>
                            
                                <aura:iteration items="{!v.templates}" var="template">  
                                   <aura:if isTrue="{!template.Id == v.selectedTemplateId}">  
                                        <p class="slds-text-color_success" >Plan tasks include:</p>
                                         <div class="slds-box">
                                            <aura:iteration items="{!template.ActionPlanTemplateItems}" var="task">
                                                <div class="actionItem slds-p-vertical_xx-small"><span class="asterisk" style="{!task.IsRequired == true ? '' : 'visibility:hidden'}">*</span>{!task.Name}</div>
                                            </aura:iteration>
                                        </div>
                                </aura:if>
                                </aura:iteration>
                            </lightning:layoutItem>
                       </lightning:layout>
            </div>
        </fieldset>    
                
                <aura:set attribute="actions">
                    <lightning:button class="slds-theme_neutral" variant="neutral" label="Create Plan" onclick="{!c.handleCreatePlan}"></lightning:button>
                </aura:set>
               
            </lightning:card>
        </aura:if>
        
        </ui:scrollerWrapper>
    </div>
</aura:component>